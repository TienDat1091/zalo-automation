<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flow Builder v4</title>
  <link rel="stylesheet" href="/assets/style_trigger_builder.css">
  <link rel="stylesheet" href="/assets/unified-header.css?v=4">
  <style>
    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* Sub-header for Builder Actions */
    .builder-toolbar {
      background: #fff;
      border-bottom: 1px solid #e0e0e0;
      padding: 8px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 50px;
      flex-shrink: 0;
    }

    .main-container {
      flex: 1;
      height: calc(100vh - 114px) !important;
      /* 64px header + 50px toolbar */
    }
  </style>
</head>

<body>
  <div class="builder-toolbar">
    <div class="header-left">
      <button class="btn" onclick="location.href='trigger-manager.html'">Quay láº¡i</button>
      <div class="trigger-title">
        <span class="icon">ğŸ”„</span>
        <h1 id="triggerName">Loading...</h1>
        <span class="badge active" id="triggerBadge">Active</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" onclick="showToast('âœ… Tá»± Ä‘á»™ng lÆ°u!','success')">ğŸ’¾ LÆ°u</button>
    </div>
  </div>

  <div class="main-container">
    <div class="blocks-panel">
      <div class="panel-header">
        <h3>Khá»‘i chá»©c nÄƒng</h3>
        <div class="search-box">
          <span class="search-icon">ğŸ”</span>
          <input type="text" placeholder="TÃ¬m..." id="blockSearch" oninput="filterBlocks()">
        </div>
      </div>
      <div class="blocks-list" id="blocksList"></div>
    </div>

    <div class="canvas-area">
      <div class="canvas-content">
        <div class="flow-container" id="flowContainer"></div>
      </div>
    </div>

    <div class="properties-panel hidden" id="propertiesPanel">
      <div class="properties-header">
        <h3 id="propertiesTitle">CÃ i Ä‘áº·t</h3>
        <button class="close-panel-btn" onclick="closePropertiesPanel()">âœ•</button>
      </div>
      <div class="properties-content" id="propertiesContent"></div>
    </div>
  </div>

  <!-- Variables Modal - Enhanced with Tabs -->


  <script>
    // Tab switching

  </script>

  <!-- Base & Registry -->
  <!-- Load index.js TRÆ¯á»šC (core registry) -->
  <script src="blocks/index.js"></script>

  <!-- Sau Ä‘Ã³ load tá»«ng block -->
  <script src="blocks/send-message.js"></script>
  <script src="blocks/send-image.js"></script>
  <script src="blocks/send-file.js"></script>
  <script src="blocks/send-friend-request.js"></script>
  <script src="blocks/accept-friend-request.js"></script>
  <script src="blocks/delay.js"></script>
  <script src="blocks/run-block.js"></script>
  <script src="blocks/condition.js"></script>
  <script src="blocks/user-input.js"></script>
  <script src="blocks/set-variable.js"></script>
  <script src="blocks/clear-variable.js"></script>
  <script src="blocks/bot-active.js"></script>
  <script src="blocks/webhook.js"></script>
  <script src="blocks/ai-gemini.js"></script>
  <script src="blocks/payment-hub.js"></script>
  <script src="blocks/table-data.js"></script>
  <script src="blocks/switch.js"></script>
  <script src="blocks/google-sheet-data.js"></script>
  <script src="blocks/send-email.js"></script>
  <script src="blocks/find-user.js"></script>
  <!-- UI Controller - Load CUá»I CÃ™NG -->
  <script src="/assets/unified-header.js?v=4"></script>
  <script src="assets/websocket-helper.js"></script>
  <script src="/chat-function/variable-autocomplete.js"></script>
  <script src="blocks/flow-builder-ui.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (window.UnifiedHeader) {
        UnifiedHeader.setPageActions(UnifiedHeader.getSharedTogglesHTML());
      }
    });
  </script>
</body>

</html>