<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flow Builder v4</title>
  <link rel="stylesheet" href="/assets/style_trigger_builder.css">
</head>

<body>
  <div class="header">
    <div class="header-left">
      <button class="btn" onclick="location.href='trigger-manager.html'">Quay láº¡i</button>
      <div class="trigger-title">
        <span class="icon">ğŸ”„</span>
        <h1 id="triggerName">Loading...</h1>
        <span class="badge active" id="triggerBadge">Active</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn" onclick="showVariablesModal()" title="Xem táº¥t cáº£ biáº¿n Ä‘Ã£ lÆ°u">ğŸ“Š Biáº¿n</button>
      <a href="unified-manager.html" target="_blank" rel="noopener noreferrer" class="btn">
        <span>ğŸ“Š</span>
        <span>Data Manager</span>
      </a>
      <button class="btn btn-primary" onclick="showToast('âœ… Tá»± Ä‘á»™ng lÆ°u!','success')">ğŸ’¾ LÆ°u</button>
    </div>
  </div>

  <div class="main-container">
    <div class="blocks-panel">
      <div class="panel-header">
        <h3>Khá»‘i chá»©c nÄƒng</h3>
        <div class="search-box">
          <span class="search-icon">ğŸ”</span>
          <input type="text" placeholder="TÃ¬m..." id="blockSearch" oninput="filterBlocks()">
        </div>
      </div>
      <div class="blocks-list" id="blocksList"></div>
    </div>

    <div class="canvas-area">
      <div class="canvas-content">
        <div class="flow-container" id="flowContainer"></div>
      </div>
    </div>

    <div class="properties-panel hidden" id="propertiesPanel">
      <div class="properties-header">
        <h3 id="propertiesTitle">CÃ i Ä‘áº·t</h3>
        <button class="close-panel-btn" onclick="closePropertiesPanel()">âœ•</button>
      </div>
      <div class="properties-content" id="propertiesContent"></div>
    </div>
  </div>

  <!-- Variables Modal -->
  <div id="variablesModal" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3>ğŸ“Š Danh sÃ¡ch biáº¿n Ä‘Ã£ lÆ°u</h3>
        <button class="modal-close-btn" onclick="closeVariablesModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <!-- Add Variable Form -->
        <div id="addVariableForm" style="background: #f5f7fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
          <h4 style="margin-bottom: 12px; font-size: 14px;">â• ThÃªm biáº¿n thá»§ cÃ´ng</h4>
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 150px;">
              <label style="display: block; font-size: 12px; margin-bottom: 4px; color: #666;">TÃªn biáº¿n</label>
              <input type="text" id="newVarName" placeholder="VD: user_email"
                style="width: 100%; padding: 8px 12px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 13px;">
            </div>
            <div style="flex: 2; min-width: 200px;">
              <label style="display: block; font-size: 12px; margin-bottom: 4px; color: #666;">GiÃ¡ trá»‹</label>
              <input type="text" id="newVarValue" placeholder="VD: test@example.com"
                style="width: 100%; padding: 8px 12px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 13px;">
            </div>
            <div style="flex: 1; min-width: 100px;">
              <label style="display: block; font-size: 12px; margin-bottom: 4px; color: #666;">Loáº¡i</label>
              <select id="newVarType"
                style="width: 100%; padding: 8px 12px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 13px;">
                <option value="text">text</option>
                <option value="number">number</option>
                <option value="email">email</option>
                <option value="phone">phone</option>
              </select>
            </div>
            <div style="display: flex; align-items: flex-end;">
              <button class="btn btn-primary" onclick="addManualVariable()" style="padding: 8px 16px;">â• ThÃªm</button>
            </div>
          </div>
        </div>
        <div id="variablesContent">
          <div class="loading-spinner">Äang táº£i...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="refreshVariables()">ğŸ”„ LÃ m má»›i</button>
        <button class="btn btn-danger" onclick="clearAllVariables()">ğŸ—‘ï¸ XÃ³a táº¥t cáº£</button>
        <button class="btn" onclick="closeVariablesModal()">ÄÃ³ng</button>
      </div>
    </div>
  </div>

  <!-- Base & Registry -->
  <!-- Load index.js TRÆ¯á»šC (core registry) -->
  <script src="blocks/index.js"></script>

  <!-- Sau Ä‘Ã³ load tá»«ng block -->
  <script src="blocks/send-message.js"></script>
  <script src="blocks/send-image.js"></script>
  <script src="blocks/send-file.js"></script>
  <script src="blocks/send-friend-request.js"></script>
  <script src="blocks/accept-friend-request.js"></script>
  <script src="blocks/delay.js"></script>
  <script src="blocks/run-block.js"></script>
  <script src="blocks/condition.js"></script>
  <script src="blocks/user-input.js"></script>
  <script src="blocks/set-variable.js"></script>
  <script src="blocks/clear-variable.js"></script>
  <script src="blocks/bot-active.js"></script>
  <script src="blocks/webhook.js"></script>
  <script src="blocks/ai-gemini.js"></script>
  <script src="blocks/payment-hub.js"></script>
  <script src="blocks/table-data.js"></script>
  <script src="blocks/switch.js"></script>
  <script src="blocks/google-sheet-data.js"></script>
  <script src="blocks/send-email.js"></script>
  <!-- UI Controller - Load CUá»I CÃ™NG -->
  <script src="blocks/flow-builder-ui.js"></script>


</body>

</html>